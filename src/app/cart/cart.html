<app-nav-bar></app-nav-bar>
<div class="cart-page">
  <div class="cart-container">
    <div class="cart-header">
      <h1>üõí Mi Carrito</h1>
      <button class="btn-back" (click)="continueShopping()">
        <i class="fa-solid fa-arrow-left"></i> Seguir comprando
      </button>
    </div>

    <div *ngIf="cartItems.length === 0" class="empty-cart">
      <div class="empty-icon">üõí</div>
      <h2>Tu carrito est√° vac√≠o</h2>
      <p>Agrega productos para comenzar tu compra</p>
      <button class="btn-shop" (click)="continueShopping()">
        Ir a la tienda
      </button>
    </div>

    <div *ngIf="cartItems.length > 0" class="cart-content">
      <div class="cart-items">
        <div class="cart-items-header">
          <h3>Productos ({{ cartItems.length }})</h3>
          <button class="btn-clear" (click)="clearCart()">
            <i class="fa-solid fa-trash"></i> Vaciar carrito
          </button>
        </div>

        <div class="cart-item" *ngFor="let item of cartItems">
          <div class="item-image">
            <img 
              [src]="item.product.imagen || 'https://via.placeholder.com/120x120/FFC107/000000?text=' + item.product.name" 
              [alt]="item.product.name"
              loading="lazy"
              (error)="$any($event.target).src='https://via.placeholder.com/120x120/FFC107/000000?text=' + item.product.name"
            />
          </div>
          
          <div class="item-details">
            <h4>{{ item.product.name }}</h4>
            <p class="item-category">{{ item.product.categoria || 'Sin categor√≠a' }}</p>
            <p class="item-price">S/{{ item.product.price | number:'1.2-2' }}</p>
          </div>

          <div class="item-quantity">
            <button class="qty-btn" (click)="decreaseQuantity(item.product.id)">
              <i class="fa-solid fa-minus"></i>
            </button>
            <span class="qty-value">{{ item.quantity }}</span>
            <button class="qty-btn" (click)="increaseQuantity(item.product.id)">
              <i class="fa-solid fa-plus"></i>
            </button>
          </div>

          <div class="item-subtotal">
            <p class="subtotal-label">Subtotal</p>
            <p class="subtotal-value">S/{{ (item.product.price * item.quantity) | number:'1.2-2' }}</p>
          </div>

          <button class="btn-remove" (click)="removeItem(item.product.id)">
            <i class="fa-solid fa-trash"></i>
          </button>
        </div>
      </div>

      <div class="cart-summary">
        <div class="summary-card">
          <h3>Resumen del pedido</h3>
          
          <div class="summary-line">
            <span>Subtotal</span>
            <span>S/{{ subtotal | number:'1.2-2' }}</span>
          </div>
          
          <div class="summary-line">
            <span>IGV (18%)</span>
            <span>S/{{ igv | number:'1.2-2' }}</span>
          </div>
          
          <div class="summary-divider"></div>
          
          <div class="summary-line summary-total">
            <span>Total</span>
            <span>S/{{ total | number:'1.2-2' }}</span>
          </div>

          <div class="payment-method-selector">
            <label class="payment-label">
              <i class="fa-solid fa-credit-card"></i>
              M√©todo de pago:
            </label>
            <div class="payment-options">
              <div class="payment-option" 
                   [class.selected]="metodoPago === 'tarjeta'" 
                   (click)="metodoPago = 'tarjeta'">
                <div class="payment-icon">
                  <i class="fa-solid fa-credit-card"></i>
                </div>
                <div class="payment-info">
                  <span class="payment-name">Tarjeta</span>
                  <span class="payment-desc">Cr√©dito/D√©bito</span>
                </div>
                <div class="payment-brands">
                  <i class="fa-brands fa-cc-visa"></i>
                  <i class="fa-brands fa-cc-mastercard"></i>
                </div>
              </div>
              
              <div class="payment-option" 
                   [class.selected]="metodoPago === 'agora'" 
                   (click)="metodoPago = 'agora'">
                <div class="payment-icon">
                  <i class="fa-solid fa-money-bill-wave"></i>
                </div>
                <div class="payment-info">
                  <span class="payment-name">Pago en Agora</span>
                  <span class="payment-desc">Escanea el QR</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Formulario de tarjeta (datos de relleno) -->
          <div class="card-form" *ngIf="metodoPago === 'tarjeta'">
            <h3>
              <i class="fa-solid fa-lock"></i>
              Datos de la tarjeta (Demo)
            </h3>
            <p class="card-info-note">
              <i class="fa-solid fa-info-circle"></i>
              Estos son datos de prueba. En producci√≥n se integrar√≠a con una pasarela de pago real.
            </p>
            
            <div class="form-group">
              <label>N√∫mero de tarjeta</label>
              <input type="text" 
                     value="4532 1234 5678 9010" 
                     readonly 
                     class="form-control card-input" />
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Vencimiento</label>
                <input type="text" 
                       value="12/25" 
                       readonly 
                       class="form-control card-input" />
              </div>
              <div class="form-group">
                <label>CVV</label>
                <input type="text" 
                       value="123" 
                       readonly 
                       class="form-control card-input" />
              </div>
            </div>

            <div class="form-group">
              <label>Titular de la tarjeta</label>
              <input type="text" 
                     value="JUAN PEREZ GARCIA" 
                     readonly 
                     class="form-control card-input" />
            </div>

            <div class="card-visual">
              <div class="card-chip">
                <i class="fa-solid fa-credit-card"></i>
              </div>
              <div class="card-number">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 9010</div>
              <div class="card-holder">
                <span class="label">Titular</span>
                <span class="name">JUAN PEREZ GARCIA</span>
              </div>
              <div class="card-brand">
                <i class="fa-brands fa-cc-visa"></i>
              </div>
            </div>
          </div>

          <!-- QR de Agora -->
          <div class="agora-payment" *ngIf="metodoPago === 'agora'">
            <div class="agora-header">
              <i class="fa-solid fa-qrcode"></i>
              <h3>Pago con Agora</h3>
            </div>
            <p class="agora-instructions">
              Escanea el c√≥digo QR con tu aplicaci√≥n de Agora para completar el pago
            </p>
            
            <div class="qr-container">
              <img [src]="qrCodeUrl" alt="QR Code Agora" class="qr-code" />
              <div class="qr-overlay">
                <i class="fa-solid fa-mobile-screen"></i>
                <span>Escanear con Agora</span>
              </div>
            </div>

            <div class="agora-details">
              <div class="detail-item">
                <span class="detail-label">Monto a pagar:</span>
                <span class="detail-value">S/ {{ total | number:'1.2-2' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">ID de transacci√≥n:</span>
                <span class="detail-value">{{ transactionId }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Tiempo restante:</span>
                <span class="detail-value countdown">{{ countdown }}s</span>
              </div>
            </div>

            <div class="agora-note">
              <i class="fa-solid fa-info-circle"></i>
              <span>El c√≥digo QR expirar√° en {{ countdown }} segundos. Renueva la p√°gina si necesitas m√°s tiempo.</span>
            </div>
          </div>

          <button class="btn-checkout" (click)="checkout()" [disabled]="procesandoPago || !metodoPago">
            <span class="btn-icon">
              <i class="fa-solid fa-lock"></i>
            </span>
            <span class="btn-text">
              {{ procesandoPago ? 'Procesando pago...' : 'Proceder al pago' }}
            </span>
            <span class="btn-amount">S/ {{ total | number:'1.2-2' }}</span>
          </button>

          <div class="payment-methods">
            <p>M√©todos de pago aceptados:</p>
            <div class="payment-icons">
              <i class="fa-brands fa-cc-visa"></i>
              <i class="fa-brands fa-cc-mastercard"></i>
              <i class="fa-solid fa-money-bill"></i>
            </div>
          </div>
        </div>

        <div class="delivery-info">
          <h4><i class="fa-solid fa-truck"></i> Informaci√≥n de entrega</h4>
          <p>Entrega gratis en compras mayores a S/50.00</p>
          <p>Tiempo estimado: 24-48 horas</p>
        </div>
      </div>
    </div>
  </div>
</div>

<app-footer></app-footer>
